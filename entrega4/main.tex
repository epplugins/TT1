\documentclass[a4paper,11pt,dvipsnames]{article}
% \usepackage[draft]{pgf}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[style=numeric, sorting=none]{biblatex}
\addbibresource{../references.bib}
\usepackage[spanish, es-tabla]{babel}
\usepackage{tocloft}
\usepackage{mathrsfs}
\usepackage{amssymb,amsmath}
\usepackage{enumerate}
\usepackage{csquotes} % Removes a warning related to babel
% \usepackage{enumitem}  % It's better than enumerate
% \usepackage{multirow}
\usepackage{caption}
\captionsetup[table]{skip=0pt}

\usepackage{graphicx}
\graphicspath{ {img/} }

% \usepackage{ifthen}
\usepackage{xcolor}
% \usepackage{color}
% \usepackage{tabularx}
\usepackage[colorlinks]{hyperref}
%setup new colors
\hypersetup{
linkcolor=BrickRed
,citecolor=NavyBlue
,filecolor=Mulberry
,urlcolor=NavyBlue
,menucolor=BrickRed
,runcolor=Mulberry
,linkbordercolor=BrickRed
,citebordercolor=Green
,filebordercolor=Mulberry
,urlbordercolor=NavyBlue
,menubordercolor=BrickRed
,runbordercolor=Mulberry
}

\usepackage[locale=FR, per-mode=fraction, separate-uncertainty=true]{siunitx}
\usepackage{physics}

% Exporting matplotlib figures to pgfplots
% \usepackage{layouts}
% Use this to get the width
% \printinunitsof{in}\prntlen{\textwidth}
% and adjust the matplotlib figure based on that:
% fig.set_size_inches(w=4.7747, h=3.5)
% %


\usepackage{pgfplots}
\usepackage{tikz}
% \usepackage{tikz-3dplot}
\usetikzlibrary{decorations.pathreplacing,shapes,patterns,calc}
\usetikzlibrary{babel}


\usepackage[a4paper,vmargin={15mm,20mm},hmargin={20mm,15mm}, includefoot, bottom=3.5cm]{geometry}
\usepackage{fancybox}
% \usepackage{lastpage}
\usepackage{fancyhdr}
\setlength{\headheight}{60pt}
\pagestyle{fancy}
\fancyhead{}
% \rhead{2\textsuperscript{do} 31 - 2023}
% \lhead{\input{logoFRA.tex}}
\chead{\rmfamily\fontsize{9}{0}\selectfont Análisis de la influencia de factores exógenos en la deserción de estudiantes en el CBC}
% \rfoot{\thepage\ / \pageref{LastPage}}
% \cfoot{}
% \lfoot{\textit{hola}}
% \renewcommand{\footrulewidth}{0.4pt}

\begin{document}

\begin{titlepage}
    \begin{center}

        \begin{minipage}{0.3\textwidth}
            \begin{flushright}
            \includegraphics[width=0.7\textwidth]{Logo-UBA}
            \end{flushright}
        \end{minipage}
        \begin{minipage}{0.6\textwidth}
            {\Large
            Universidad de Buenos Aires\par\medskip
            Facultad de Ciencias Exactas y Naturales
            }
        \end{minipage}

        \vspace*{3cm}

        \Huge
        \textbf{Análisis de la influencia de factores exógenos en la deserción de estudiantes en el Ciclo Básico Común de la Universidad de Buenos Aires}

        \vspace{0.5cm}
        \LARGE

        \vspace{1.5cm}

        \textbf{Edgardo Palazzo} \\ \normalsize epalazzo@cbc.uba.ar

        \vfill

        \Large
        Buenos Aires, Argentina\\
        Julio 2023

    \end{center}
\end{titlepage}

\newpage
\thispagestyle{fancy}
\pagenumbering{roman}
\tableofcontents

\newpage
\pagenumbering{arabic}


\section*{Resumen}
\addcontentsline{toc}{section}{\protect\numberline{}Resumen}%

En este trabajo se analizan las bases de datos de estudiantes de la cátedra de física del Ciclo Básico Común de la Universidad de Buenos Aires \footnote[1]{https://www.cbc.uba.ar/}, que contienen un historial de calificaciones de cada estudiante en las materias de la cátedra, desde el año 2011 hasta el año 2019. El objetivo es determinar si el desgranamiento de los cursos está influenciado por las variables contenidas en los datos existentes, que en gran parte son consideradas como variables exógenas respecto al estudiante.\par\medskip
Calculando precisiones medias (AP) y analizando importancias de variables de modelos clasificadores entrenados con XGBoost, que predicen si un estudiante abandona o no después de rendir el primer examen parcial, se detectó una leve influencia de las variables exógenas en el desgranamiento de cursos.

\section{Introducción}

El enfoque general que se observa en los trabajos sobre deserción, o sobre rendimiento estudiantil, donde se aplican técnicas de minería de datos, es el análisis del problema incluyendo toda la información externa a la institución que se pueda conseguir, consideradas como variables endógenas respecto de los estudiantes, especialmente las características socioeconómicas de los mismos \cite{GarciaDeFanelli:RAESrendimiento}. Los factores más comunes en este tipo de trabajos están relacionados a las notas previas y desempeño en clase del estudiante, a sus actividades de estudio en línea, a variables demográficas del estudiante, y a su información social \cite{Saa:review}. Sin embargo, como propone Vincent Tinto, las instituciones educativas deben reconocer que la deserción, o un avance lento, también puede tener raíces en el entorno en el cual se les pide a los estudiantes que aprendan \cite{Tinto:firstyear}. Este trabajo apunta precisamente en esa dirección, realizando un análisis que incluya variables relacionadas con el entorno en el que cada estudiante cursa las materias, para determinar si hay influencia, y en qué medida, de estas variables sobre el nivel de deserción.\par\medskip

Para responder la pregunta planteada se propone entrenar modelos clasificadores para realizar predicciones sobre desgranamiento, en particular, predecir cuáles estudiantes que rindieron el primer examen parcial luego abandonaron el curso antes de rendir el segundo y último examen parcial. Y en el caso de lograr entrenar modelos con rendimientos superiores al azar, analizar las importancias de las variables para evaluar sus influencias en la deserción de estudiantes.\par\medskip

La elección sobre predecir desgranamiento y no incluir además predicciones a la deserción de estudiantes al comenzar el curso no es arbitraria. Es normal que en muchos de los cursos del C.B.C. no se controle asistencia de los estudiantes, y en particular se sabe que no se controló la asistencia en los cursos correspondientes con los datos de este trabajo. Por lo tanto, entre los registros de estudiantes que no poseen calificaciones en el primer examen parcial, no es posible discriminar si se trata de estudiantes que abandonaron antes de la instancia del primer parcial, si se presentaron a alguna clase o si directamente desistieron de presentarse al curso antes de comenzar el cuatrimestre. En cambio, el análisis de los estudiantes que abandonan entre primer y segundo parcial es más sólido teniendo en cuenta los datos a disposición. Se trata observaciones que contienen una calificación en el primer examen parcial (en lugar de ser un dato faltante), y corresponden a estudiantes que hicieron el esfuerzo por continuar en la materia y cumplieron con la condición de rendir el primer examen parcial, pero no se presentaron a rendir el segundo examen parcial, representados con datos faltantes en la variable asociada.\par\medskip

Lo primero que sigue a continuación es un marco teórico que presenta el tipo de algoritmo utilizado para entrenar los modelos, la métrica seleccionada para evaluar sus rendimientos y las técnicas para analizar las importancias de las variables. Siguiente al marco teórico se presentan los datos y un análisis exploratorio de los mismos, que en parte fue retroalimentado por algunos resultados preliminares. Al finalizar la exploración se pasa a los métodos experimentales, donde se explica como se entrenaron distintos modelos clasificadores, para luego encontrar una discusión sobre sus resultados y la conclusión.

\section{Marco teórico}

La utilización de ciencia de datos aplicada a educación ha proliferado en tal medida que hasta se ha generalizado en inglés la denominación \textit{``Educational Data Mining''} \cite{Romero5524021}, técnica que también es muy aplicada en universidades argentinas (ver como ejemplo el trabajo de D. Kuna y otros \cite{kuna:abandono}). Entre los métodos más usados para estudiar rendimiento de estudiantes sobresalen las redes neuronales y los árboles de decisión, siendo los que alcanzan mejores rendimientos predictivos \cite{SHAHIRI2015414}. Si bien las redes neuronales entregan las mejores predicciones, los árboles de decisión además permiten comprender los resultados de una forma más simple.

\subsection{Algoritmo: XGBoost}

Siendo que el objetivo del trabajo no es buscar los mejores algoritmos para predecir la deserción de estudiantes, sino entrenar modelos que permitan detectar qué factores influyen en dicha deserción, se optó por el algoritmo XGBoost \cite{Chen:2016:XST:2939672.2939785}, que incluye muchas de las bondades de los árboles de decisión pero que además ha demostrado ser muy eficiente y rápido para analizar conjuntos de datos tabulares muy grandes, características a tener en cuenta si se desea extender este trabajo a un conjunto de datos aumentado. Si bien no se buscará el modelo con mayor poder de predicción, para tener más certezas en el estudio de las importancias de las variables es necesario alcanzar buenos rendimientos. XGBoost permite mejorar los rendimientos con entrenamientos rápidos, considerando la gran cantidad de datos con la que se trabajó, y al mismo tiempo ofrece la posibilidad de interpretar los resultados.

\subsection{Métricas: AUCPR y AP}

Cuando los datos son desequilibrados, una de las métricas generalmente recomendadas para medir el rendimiento de modelos de clasificación binaria es el área bajo la curva \textit{precision-recall} , o AUCPR (\textit{area under the curve precision-recall}) \cite{Davis:AUC-PR}. Esta métrica resulta conveniente para este trabajo porque resume el rendimiento del modelo para todos los valores de corte, evitando tener que buscar un corte óptimo para las predicciones, el cual puede cambiar arbitrariamente por un futuro usuario según sus acciones a seguir con dichas predicciones. La línea de base de la métrica AUCPR es \cite{Saito:AUCPR}:
\begin{equation}\label{eq:base}
    y = \dfrac{P}{P+N}
\end{equation}

siendo $y$ la altura en una gráfica \textit{precision-recall}, y donde $P$ representa la cantidad de observaciones positivas y $N$ las negativas. De esta forma el área bajo la curva \textit{precision-recall} obtenida por un clasificador al azar resulta igual a la proporción de observaciones positivas sobre el total de observaciones. Sin embargo, pueden surgir malas interpretaciones al comparar rendimientos de diferentes modelos únicamente teniendo en cuenta dicha línea de base, debido a que en el espacio \textit{precision-recall} existe una región inalcanzable que depende del desequilibrio del conjunto de datos \cite{boyd2012unachievable}. La curva \textit{precision-recall} siempre se encuentra por encima de esta región inalcanzable que define un mínimo para el AUCPR, y, si representamos al desequilibrio como $\pi = \text{P}/(\text{P+N})$, este mínimo se puede calcular de la siguiente forma:
\begin{equation}
    \text{AUCPR}_\text{min} = 1 + \dfrac{(1-\pi)\ln(1-\pi)}{\pi}
\end{equation}

Para obtener el valor de AUCPR es necesario contar con la curva \textit{precision} vs. \textit{recall} completa, y esto solo puede ser aproximado por los experimentos. Un método para aproximar el AUCPR es calculando la precisión media, o AP (\textit{average precision}), de la siguiente forma:
\begin{equation}
    \text{AP} = \sum_n (R_n - R_{n-1})P_n
\end{equation}
donde $P_n$ y $R_n$ son los valores de \textit{precision} y de \textit{recall} alcanzados en el corte $n$-ésimo.


\section{Datos}

\subsection{Descripción de los datos utilizados}

Los datos fueron provistos en distintas tablas de MS Access con diferentes estructuras que fueron unificadas en una tabla dentro de un archivo \texttt{csv}. Cada registro de esta tabla de datos corresponde a la información de un estudiante en un curso. La tabla \ref{tab:tamanio} muestra la cantidad de registros, de estudiantes y de sedes, y podemos notar que el número de estudiantes es muy inferior a la cantidad total de observaciones porque un gran número de estudiantes se inscribe a una de las materias de esta cátedra en más de una oportunidad.\par\medskip

\begin{table}[!hb]
    % \small
    \caption{Cantidad de registros, estudiantes y sedes en los datos originales.}
    \begin{center}
    \begin{tabular}{cl}
    \hline
    \textbf{Ítem} & \textbf{Cantidad}\\
    \hline
    observaciones & 233615\\
    estudiantes & 120364\\
    sedes & 21\\
    \hline
    \end{tabular}
    \label{tab:tamanio}
    \end{center}
\end{table}

En la tabla \ref{tab:originales} se describen brevemente las variables que integran esos datos. Aunque es sencillo comprender qué representa cada variable listada en dicha tabla, vale hacer las siguientes aclaraciones. Las notas de los exámenes de un estudiante pueden estar vacías (alguna o todas), y eso representará que el estudiante no rindió ese examen. Además, cuando el estudiante alcanza la condición que lo habilita a rendir un examen final, tiene tres oportunidades consecutivas para hacerlo, y las calificaciones de esas oportunidades se encuentran en las variables \texttt{Final}, \texttt{rem1} y \texttt{rem2}.\par\medskip

\begin{table}[!h]
    % \small
    \caption{Variables originales. En la columna de valores se muestra el contenido que se debería encontrar en cada variable. (\texttt{nan}: \textit{not a number})}
    \begin{center}
    \begin{tabular}{cll}
    \hline
    \textbf{Variable} & \textbf{Descripción} & \textbf{Valores}\\
    \hline
    \texttt{anio} & El año en que el estudiante cursó en un determinado curso. & 2011, 2012, \dots, 2019\\
    \texttt{cuat} & El cuatrimestre en que el estudiante cursó. & 1 o 2\\
    \texttt{dni} & Documento Nacional de Identidad. & Ejemplo: 42000251\\
    \texttt{COMISION} & Código utilizado para los cursos. & Ejemplo: 45301\\
    \texttt{HORARIO} & Código utilizado para los diferentes turnos. & Ejemplo: 658\\
    \texttt{AULA} & Número de aula donde se desarrolla el curso. & Ejemplos: 1, 13, 214\\
    \texttt{SEDE} & Código de sede donde se desarrolla el curso. & Ejemplos: 1, 4, 28\\
    \texttt{MATERIA} & Código de la materia que cursa el estudiante. & 3 o 53\\
    \texttt{pa1} & Nota del primer parcial. & 0 a 10, o \texttt{nan}\\
    \texttt{pa2} & Nota del segundo parcial. & 0 a 10, o \texttt{nan}\\
    \texttt{Final} & Nota del examen final. & 0 a 10, o \texttt{nan}\\
    \texttt{codCarrera} & Código que identifica la carrera del estudiante. & Ejemplos: 9, 45\\
    \texttt{facultad} & Nombre de la facultad para la carrera del estudiante. & Ejemplo: MEDICINA\\
    \texttt{rem1} & Nota del examen final en 2da oportunidad. & 0 a 10, o \texttt{nan}\\
    \texttt{rem2} & Nota del examen final en 3ra oportunidad. & 0 a 10, o \texttt{nan}\\
    \hline
    \end{tabular}
    \label{tab:originales}
    \end{center}
\end{table}

\subsection{Limpieza y preparación de los datos}

Los datos fueron generados por múltiples usuarios con diversidad de criterios y en múltiples locaciones, por lo cual era esperable encontrarse con muchos datos erróneos o indeterminados, además de diferentes nomenclaturas. El trabajo de estandarización y limpieza fue bastante extenso, y a continuación solo se muestra un resumen.\par\medskip

Acciones relacionadas a nombres de facultades, carreras y códigos de carrera:
\begin{itemize}
    \item Estandarización de los nombres de Facultades. Los casos indefinidos se reemplazaron por un código que los diferencie del resto.
    \item Los nombres de las carreras contenían diferentes denominaciones para una misma carrera y caracteres extraños, que fueron estandarizados según la información que se encuentra en la página del Ciclo Básico Común \cite{cbc:carreras}.
    \item Los registros con información faltante sobre facultad, carrera o código de carrera, se completaron utilizando los códigos o nombres en otros registros completos cuando fue posible encontrar alguna relación entre las observaciones.
    \item Se eliminaron los registros con códigos de carreras inexistentes o sin código ni información sobre carrera o facultad. (Cerca de 80 observaciones)
\end{itemize}

Luego de esta estandarización, alrededor de un 12\% de las observaciones contienen un código de carrera (99 o 999) que no está asociado a ninguna carrera ni facultad, y no contienen información adicional como el nombre de la carrera o la facultad, en ninguno de los registros de esos estudiantes. Luego de un análisis exploratorio se decidirá si imputar o no esos valores y cómo hacerlo.\par\medskip

En cuanto a las variables relacionadas con calificaciones, se encontraron 231 observaciones con valores no esperados, como por ejemplo 25 o 98. En los casos en que fue posible, se imputaron valores según la información de las otras notas. Al tratarse de muy pocos registros, cuando no había información concluyente simplemente se reemplazaron por valores posibles, sin dedicar demasiado tiempo a una imputación más inteligente. De ser necesaria una corrección a este método (luego de los análisis correspondientes), una posibilidad es reemplazar por las notas más probables o que respeten alguna distribución en el curso, sede o turno.\par\medskip

Para finalizar se puede mencionar que se imputaron valores faltantes en COMISION y AULA en 120 observaciones, utilizando valores posibles según la sede y el horario de cada registro.\par\medskip

\subsection{Ingeniería de variables}

En la tabla \ref{tab:nuevas} se resume una descripción de las variables creadas en esta etapa del trabajo. A partir de ahora, cada observación tendrá la información sobre un estudiante en un curso y además información sobre el curso y los demás estudiantes del curso. El objetivo de la creación de estas variables es incluir factores exógenos que intuitivamente se relacionan con desempeño académico o deserción, como el número de estudiantes o la composición de los cursos según alguna característica, que están bajo el control de la universidad, y de esta forma poder analizar si las decisiones de la institución en estos aspectos tienen una influencia medible.\par\medskip

\begin{table}[!ht]
    % \small
    \caption{Variables creadas.}
    \begin{center}
    \begin{tabular}{cl}
    \hline
    \textbf{Variable} & \textbf{Descripción}\\
    \hline
    \texttt{extranjero}  & 0 o 1. Es extranjero si dni >\, 90 millones.\\
    \texttt{curso} & Identificación única de curso.\\
    \texttt{turno} & A: muy temprano, B: media mañana, C: tarde, D: noche.\\
    \texttt{n\_alum} & Cantidad de estudiantes inscriptos en el curso.\\
    \texttt{p\_ext} & Porcentaje de extranjeros en el curso.\\
    \texttt{recurso} & Cantidad de veces que se inscribió anteriormente.\\
    \texttt{p\_recursa} & Porcentaje de recursantes en el curso.\\
    \texttt{sala} & Identificación única de aula.\\
    \texttt{pa1\_prom} & Promedio de calificaciones de parcial 1 en el curso.\\
    \texttt{pa2\_prom} & Promedio de calificaciones de parcial 2 en el curso.\\
    \texttt{final\_prom} & Promedio de calificaciones de final en el curso.\\
    \texttt{edad}        & Categoría estimada con dni.\\
    \texttt{prom\_edad}        & Promedio de la variable edad en cada curso.\\
    \texttt{condición} & Abandona1, Abandona2, Insuficiente, Examen, Promociona.\\
    \texttt{abandona1\_p} & Porcentaje en condición Abandona1 en el curso.\\
    \texttt{abandona2\_p} & Porcentaje en condición Abandona2 en el curso, sobre los que rindieron parcial 1.\\
    \hline
    \end{tabular}
    \label{tab:nuevas}
    \end{center}
\end{table}


Los códigos de \texttt{COMISION} se repiten en cada cuatrimestre y las numeraciones de \texttt{AULA} tienen repeticiones en diferentes sedes. Para posibilitar análisis más específicos respecto de estas variables se generaron identificadores únicos de \texttt{curso} y de \texttt{sala}, contemplando que la sala sí puede repetirse en distintos horarios y cuatrimestres para una misma sede.\par\medskip

El código \texttt{HORARIO} indica los días y horarios en que se cursa la materia. Según estos códigos se asignó la categoría \texttt{turno} a cada observación según el siguiente criterio: los cursos que comienzan al principio del día (7AM y 8AM), los que comienzan a media mañana (de 9AM a 11AM), los que comienzan a la tarde (de 1PM a 6PM) y los cursos de la noche (desde 7PM en adelante).\par\medskip

La variable \texttt{edad} es una categoría estimada a partir del \texttt{dni}. Para cada cuatrimestre se construye un histograma de los valores de \texttt{dni} formado con 10 intervalos regulares, y se extraen los límites de dichos intervalos. Luego a cada observación se le asigna la categoría de edad según a qué intervalo pertenece su dni en ese cuatrimestre. Un estudiante que recurse puede tener diferentes categorías de edad en los distintos cuatrimestres.\par\medskip

Los extranjeros poseen un código de \texttt{dni} que se diferencia de los nacionales (son valores mayores a 90 millones, cuando los números de \texttt{dni} nacionales no llegan a 60 millones), y por lo tanto no se puede determinar su categoría de edad. Para completar la variable edad en todas las observaciones, con los extranjeros se decidió imputarles un valor de \texttt{dni} extraído aleatoriamente del conjunto de \texttt{dni} sin extranjeros de cada cuatrimestre, manteniendo de esta forma la distribución de las edades, a costa de agregar errores en la edad de una porción de las observaciones. Si en el futuro se observa que esta categoría puede ser relevante, se propone repetir los experimentos para el conjunto de datos sin incluir extranjeros.\par\medskip

La categoría \texttt{condición} se determina según las siguientes reglas:
\begin{itemize}
    \item Abandona1: no tiene notas en ningún examen, abandonó antes de rendir el primer parcial.
    \item Abandona2: tiene nota en el primer parcial pero no tiene nota de segundo parcial.
    \item Insuficiente: la suma de ambos parciales es menor a 8.
    \item Examen: la suma de ambos parciales es mayor o igual a 8 y menor a 13. Son estudiantes que deben rendir un examen final para aprobar la materia.
    \item Promociona: la suma de ambos parciales es mayor o igual a 13.
\end{itemize}

Para finalizar la modificación de los datos, la variable \texttt{dni} fue sustituida por una identificación única de estudiante diferente para anonimizar su posible aparición en códigos o resultados que se deseen distribuir, y las variables \texttt{COMISION}, \texttt{AULA} y \texttt{HORARIO} fueron eliminadas.\par\medskip

Se ha considerado generar más variables, como por ejemplo la composición del curso según facultades o carreras, o descripciones sobre las distribuciones de notas, pero la generación de variables como las mencionadas demandan tiempo para su generación y su verificación, y se decidió postergar la creación de más variables para una posible continuación de este trabajo, luego de analizar los resultados. Y por supuesto, siempre es interesante incluir la variable género, en este caso el de los estudiantes, pero lamentablemente no se cuenta con esa información en forma directa. Sí se tiene acceso a los nombres de los estudiantes, y sería posible extraer el género con diferentes probabilidades a partir de esa información, quedando este análisis también pendiente para una posible segunda etapa del trabajo.


\section{Análisis exploratorio de datos}

Finalizada la preparación de los datos y la creación de nuevas variables, se generaron reportes preliminares de análisis exploratorios automatizados, demasiados extensos para ser incluidos en este informe pero que se puede consultar en el repositorio del material de este trabajo (consultar el apéndice sobre la organización de dicho repositorio). Dicho informe es exhaustivo por demás y no toda la información que contiene es relevante, pero sirve como referencia del estado de los datos en este punto del trabajo.\par\medskip

Es importante en este punto observar que durante el análisis exploratorio se detectaron cursos completos sin calificaciones ingresadas. Estos cursos aportan información al análisis exploratorio pero no son válidos para un análisis de deserción. El trabajo que a continuación se relacione con calificaciones se realiza sobre una porción de los datos que se considera válida, es decir, que todos los cursos tienen notas cargadas. Esta porción de los datos contiene 106987 observaciones consideradas válidas para el estudio sobre desgranamiento, con 1763 cursos.\par\medskip

\begin{figure}[!hb]
    \begin{center}
        \input{../img/eda_02_sedes-nalum.pgf}
    \end{center}
    \caption{Cantidad de estudiantes que se inscribieron en las sedes más grandes en cada materia y la cantidad de extranjeros.}
    \label{fig:nalum}
\end{figure}


Como primer paso se realizó un estudio del balance de los datos en diferentes categorías, del cual se desprende que las 21 sedes se pueden caracterizar según el número de estudiantes como sedes grandes o pequeñas, siendo que el 86\% de las observaciones corresponden a solo 6 sedes más grandes. Esta es una nueva variable que se puede crear respecto de la sede donde cursa cada estudiante.\par\medskip

Respecto a la cantidad de observaciones según otras categorías, a modo de ejemplo en la figura \ref{fig:nalum} (a) se muestran proporciones similares entre estudiantes de cada materia en las distintas sedes grandes, con la excepción de la sede 10 donde hay déficit de estudiantes de la materia 3, y en \ref{fig:nalum} (b) se observa que las proporciones de extranjeros también son similares en estas sedes, con una diferencia notable en la sede 1.\par\medskip

Por otro lado, en la figura \ref{fig:turnos} se pueden comparar las cantidades de inscriptos por turnos, donde hay una gran diferencia en el número de inscriptos al turno noche (D), y no se ven grandes diferencias entre sedes.\par\medskip

Estos desequilibrios en las categorías sede, materia, extranjero o turno deberán ser tenidos en cuenta al momento de interpretar resultados.


\begin{figure}[!h]
    \begin{center}
        \input{../img/eda_02_sedes-turno.pgf}
    \end{center}
    \caption{Cantidad de estudiantes que se inscribieron en las sedes más grandes en cada turno.}
    \label{fig:turnos}
\end{figure}

Para indagar sobre deserción, la variable objetivo es \texttt{Abandona1} o \texttt{Abandona2} o alguna combinación de ellas. En las figuras \ref{fig:box-cuat} y \ref{fig:box-curso} se muestran gráficos de caja de porcentajes de estudiantes que abandonan, para las sedes más grandes (las primeras 6) y algunas de las sedes pequeñas. Los porcentajes antes del primer parcial representan la cantidad de estudiantes que no rindieron el parcial 1 sobre el total de estudiantes inscriptos en el curso, y los porcentajes después del parcial 1 representan la cantidad que rindió el segundo parcial sobre los que rindieron el primero. Es notable la mayor retención entre los estudiantes que rindieron el primer parcial, y como era de esperar, hay mayor variabilidad cuando se calculan por curso respecto al porcentaje global de cada sede en cada cuatrimestre.

\begin{figure}[!t]
    \begin{center}
        \input{../img/eda_02_box-desercion.pgf}
    \end{center}
    \caption{Dispersión de los porcentajes de estudiantes que abandonan antes o después del parcial 1 en cada cuatrimestre, por sedes.}
    \label{fig:box-cuat}
\end{figure}

\begin{figure}[!h]
    \begin{center}
        \input{../img/eda_02_box-desercion-cursos.pgf}
    \end{center}
    \caption{Dispersión de los porcentajes de estudiantes que abandonan antes o después del parcial 1 en cada curso, por sedes.}
    \label{fig:box-curso}
\end{figure}\clearpage

Un análisis posible sobre desempeño académico es a través de los promedios de calificaciones. La figura \ref{fig:hist-pa1} muestra histogramas de las calificaciones obtenidas por cada estudiante en el examen parcial 1, en cada sede. Se observan distribuciones similares entre las sedes grandes y entre las sedes pequeñas, pero los histogramas de las sedes pequeñas están desplazados hacia las notas más bajas respecto de las sedes grandes. En cambio, si se analizan los histogramas de los promedios de notas de ambos parciales, no se encuentran diferencias apreciables entre las sedes grandes y pequeñas.\par\medskip
\par\medskip

\begin{figure}[!hb]
    \begin{center}
        \input{../img/eda_02_hist-notas.pgf}
    \end{center}
    \caption{Histogramas de calificaciones discriminados por sede. Cada una de las sedes grandes agrupa más de 20 mil observaciones, mientras que cada sede pequeña agrupa menos de 10 mil. El código 99 agrupa las observaciones de todas las sedes con menos de mil registros cada una.}
    \label{fig:hist-pa1}
\end{figure}

\begin{figure}[!ht]
    \begin{center}
        \input{../img/eda_02_box-promociones.pgf}
    \end{center}
    \caption{Dispersión de los porcentajes de estudiantes que promocionan cada cuatrimestre, por sedes.}
    \label{fig:box-promo}
\end{figure}

Otra forma de medir desempeño académico es mediante la condición que alcanza cada estudiante al finalizar el curso, siendo \texttt{condicion} la variable objetivo en ese caso. Como ejemplo, la figura \ref{fig:box-promo} contiene diagramas de caja de los porcentajes de estudiantes que alcanzan la condición de promoción (las notas más elevadas) en cada cuatrimestre, discriminado por sedes. Viendo que los resultados son dispares, una parte de los estudios futuros será dedicada a intentar explicar estas diferencias.\par\medskip

\begin{figure}[!hb]
    \begin{center}
        \input{../img/eda_02_pa1-abandona1.pgf}
    \end{center}
    \caption{Organización de las observaciones según la nota del parcial 1 y el porcentaje de abandonos antes del primer parcial, discriminados por estudiantes que abandonan después del parcial 1 y los que rinden el segundo parcial.}
    \label{fig:pa1}
\end{figure}

 
Ya enfocados en los modelos clasificadores que nos interesan, entre los múltiples gráficos de a pares que se pueden obtener (consultar apéndice sobre dónde acceder a gráficos de a pares realizados con estos datos), el de la figura \ref{fig:pa1} demuestra que la gran mayoría de los estudiantes que abandondan luego de rendir el primer examen parcial son los que obtuvieron calificaciones bajas en dicho examen. Y al mismo tiempo, el porcentaje de estudiantes que abandona antes del primer examen parcial en cada curso parece uniforme respecto de las notas de los estudiantes, con un leve descenso en las notas 9 y 10.\par\medskip 

También considerando los factores que pueden ser utilizados para predecir abandono después del primer parcial, la figura \ref{fig:corr} nos muestra que hay baja correlación entre las variables numéricas seleccionadas para entrenar modelos de predicción de estudiantes que abandonan entre primer y segundo parcial. \par\medskip

\begin{figure}[!ht]
    \begin{center}
        \input{../img/eda_02_correlaciones.pgf}
    \end{center}
    \caption{Mapa de correlaciones entre las variables numéricas que se consideran consistentes con un modelo de predicción de deserción entre primer y segundo parcial.}
    \label{fig:corr}
\end{figure}


\section{Métodos}

\subsection{Entrenamiento y evaluación}

Como ya se mencionó, en todos los experimentos se entrenaron modelos de clasificación binaria con el algoritmo XGBoost. Teniendo en cuenta que el objetivo último no era la predicción, sino determinar si las predicciones se alejan del azar debido a la inclusión de variables exógenes, las rutinas de entrenamiento no fueron exhaustivas. De todas formas, para descubrir las variables o interacciones de variables más importantes es necesario incluir un ajuste de hiperparámetros en los entrenamientos, porque con predictores muy débiles se pueden esperar muchas variaciones en el orden de importancia de las variables en diferentes experimentos, y perder consistencia.\par\medskip 

El camino elegido fue la validación cruzada entre 5 subconjuntos, realizando una búsqueda aleatoria en grilla de hiperparámetros. En todos los casos los hiperparámetros y sus valores que se seleccionaron en cada entrenamiento son los presentados en la tabla \ref{tab:hiperparámetros}, ya los parámetros de la validación cruzada son los mostrados en la tabla \ref{tab:cv}.

\begin{table}[!ht]
    % \small
    \caption{Grilla para búsqueda de hiperparámetros en XGBoost.}
    \begin{center}
    \begin{tabular}{cc}
    \hline
    \textbf{hiperparámetro} & \textbf{Valores o rango}\\
    \hline
    \texttt{objective}  & binary:logistic\\
    \texttt{eval\_metric} & aucpr\\
    \texttt{eta} & $(0.005,0.6)$\\
    \texttt{gamma} & $(0,20)$\\
    \texttt{max\_depth} & $(2,20)$\\
    \texttt{lambda} & $(0,20)$\\
    \texttt{alpha} & 0\\
    \hline
    \end{tabular}
    \label{tab:hiperparámetros}
    \end{center}
\end{table}

\begin{table}[!ht]
    % \small
    \caption{Parámetros para validación cruzada.}
    \begin{center}
    \begin{tabular}{cc}
    \hline
    \textbf{parámetro} & \textbf{Valor}\\
    \hline
    \texttt{num\_boost\_round}  & 1000\\
    \texttt{nfold} & 5\\
    \texttt{early\_stopping\_rounds} & 10\\
    \texttt{metric} & aucpr\\
    \hline
    \end{tabular}
    \label{tab:cv}
    \end{center}
\end{table}

Se separaron los datos en un 70\% para entrenamiento y un 30\% para evaluación, y los rendimientos de los modelos fueron cuantificados calculando el AP utilizando la librería \textit{scikit-learn} \cite{scikit-learn}, siempre en el mismo conjunto de evaluación.

\subsection{Variables}

Puede considerarse que la línea de base fue la conseguida con el modelo que incluye todas las variables consistentes con la predicción de abandono entre parcial 1 y parcial 2, listadas en la tabla \ref{tab:variables}. En los casos \texttt{codCarrera} o \texttt{facultad}, y \texttt{SEDE} o \texttt{sala}, se debió optar por una en ambos pares, ya que \texttt{facultad} es un agrupamiento de códigos de carreras, y \texttt{SEDE} un agrupamiento de salas.\par\medskip

\begin{table}[!ht]
    % \small
    \caption{Variables consistentes con la predicción de abandono entre parcial 1 y 2.}
    \begin{center}
    \begin{tabular}{cc}
    \hline
    \multicolumn{2}{c}{\textbf{variables}}\\
    \hline
    \texttt{cuat}  & \texttt{turno}\\
    \texttt{extranjero} & \texttt{p\_ext}\\
    \texttt{n\_alum} & \texttt{abandona1\_p}\\
    \texttt{pa1} & \texttt{pa1\_prom}\\
    \texttt{recurso} & \texttt{p\_recursa}\\
    \texttt{edad} & \texttt{prom\_edad}\\
    \multicolumn{2}{c}{\texttt{codCarrera} o \texttt{facultad}}\\
    \multicolumn{2}{c}{\texttt{SEDE} o \texttt{sala}}\\
    \multicolumn{2}{c}{\texttt{MATERIA}}\\
    \hline
    \end{tabular}
    \label{tab:variables}
    \end{center}
\end{table}

Los múltiples experimentos se realizaron eliminando una o varias de las variables de la tabla \ref{tab:variables}, para cuantificar la importancia de la variable eliminada, o la interacción entre variables eliminadas, determinando cuánto descendía el valor de AP, y también para analizar cómo variaban las importancias en el nuevo modelo.

\subsection{Importancia de variables y test de permutaciones}

Con los modelos que ofrezcan algún poder de predicción se pueden realizar análisis de importancias de variables. XGBoost tiene sus propios métodos para informar la importancia de las variables en cada modelo, y en este trabajo se registraron las importancias según sus aportes al cálculo de \textit{gain} total (\textit{total gain}), siendo \textit{gain} la forma en que XGBoost mide el aumento en rendimiento en cada división del árbol. Sin embargo, los resultados que entrega XGBoost pueden derivar en interpretaciones erróneas, debido a la complejidad en el cálculo de dichas ganancias.\par\medskip 

Un método alternativo y consistente (cada vez que se cambia un modelo para depender más en una variable, la importancia de esa variable no puede descender) es el ya mencionado: entrenar modelos eliminando las variables de a una (o de a pares para investigar interacciones o correlaciones) y cuantificar sus importancias según el descenso en el valor de AP. El inconveniente con este método es que demanda mucho tiempo computacional para entrenar todos los modelos.\par\medskip 

Otro método consistente y muy fácil de aplicar es el test de permutaciones para importancias \cite{AUC-based-permutation}. Con el modelo de base entrenado y su AP calculado con el conjunto de evaluación, lo que consideramos línea de base, se permutan los valores de una variable en el conjunto de evaluación y se calcula el AP de las predicciones en este conjunto permutado. La importancia de esa variable es la diferencia entre la línea de base y del AP en las predicciones sobre el conjunto con la columna permutada. Este método no requiere reentrenar modelos.

\subsection{Repeticiones}

Se realizaron algunos experimentos reentrenando el mismo modelo (las mismas variables) múltiples veces, cambiando las observaciones de los conjuntos de entrenamiento y de evaluación, con el objetivo de observar la variabilidad de los resultados de AP y las importancias de las variables según las observaciones disponibles en cada entrenamiento y evaluación.

\section{Resultados y discusión}

Los resultados de la métrica AP que se muestran en la tabla \ref{tab:aps} pueden ser interpretados de la siguiente forma. Con un clasificador al azar \cite{ojala2010:permutations} se obtuvo un AP que es igual a la proporción de casos positivos respecto del total ($0.24$), en acuerdo con lo indicado por la ecuación \ref{eq:base}. El rendimiento sobre el conjunto de evaluación del modelo base, que incluye todas las variables consistentes para este experimento, está alejado del clasificador aleatorio, indicando que existen relaciones entre los factores incluidos y la variable objetivo. Sin embargo, si se observan las importancias de las variables en la tabla \ref{tab:impbase}, encontramos que la variable \texttt{pa1} es la más importante y su importancia está muy lejos de las otras, lo cual pone en duda la interpretación del resultado de AP del modelo base. Este resultado es el usual en la mayoría de este tipo de trabajos de minería de datos en educación, donde el promedio de las notas del estudiante es determinante para decidir si completa sus estudios o no \cite{SHAHIRI2015414}.\par\medskip

\begin{table}[!ht]
    % \small
    \caption{Precision media obtenida sobre el conjunto de evaluación por los modelos: base que incluye todas las variables, modelo sin la variable pa1, y un clasificador aleatorio.}
    \begin{center}
    \begin{tabular}{rc}
    \hline
    \textbf{modelo} & \textbf{AP}\\
    \hline
    base  & $0.587$ \\
    sin \texttt{pa1}  & $0.358$ \\
    aleatorio  & $0.242$ \\
    \hline
    \end{tabular}
    \label{tab:aps}
    \end{center}
\end{table}

Para intentar entender si el modelo solo depende de la nota del parcial 1 y las demás variables son inservibles, podemos recurrir al resultado obtenido con el modelo entrenado sin incluir la variable \texttt{pa1}. El valor AP de dicho modelo es menor al valor base, como es de esperar, pero sigue siendo significativamente superior al clasificador aleatorio. Por lo cual podemos afirmar que si bien la nota del primer parcial es una gran influencia en la variable objetivo, las demás variables en conjunto también demuestran un cierto poder de predicción sobre los abandonos. Releyendo la tabla de importancias luego de este análisis, podemos interpretar que las bajas importancias se deben a interacciones entre variables y/o correlaciones que no fueron detectadas anteriormente \cite{AUC-based-permutation}.

\begin{table}[!ht]
    % \small
    \caption{Importancias informadas por XGBoost (\textit{total gain} relativo a la menor), obtenidas por el método de permutaciones, y las obtenidas por el método de eliminación de variables.}
    \begin{center}
    \begin{tabular}{cccccccc}
    \hline
    \multicolumn{2}{c}{\textbf{XGBoost}} & & \multicolumn{2}{c}{\textbf{permutaciones}} & &\multicolumn{2}{c}{\textbf{eliminación}}\\
    \cline{1-2}
    \cline{4-5}
    \cline{7-8}
    \textbf{variable} & \textbf{importancia} && \textbf{variable} & \textbf{importancia} &&\textbf{variable} & \textbf{importancia}\\
    \hline
    \texttt{pa1}  & $168.75$ && \texttt{pa1}  & $0.314$ && \texttt{pa1}  & $0.229$\\
    \texttt{abandona1\_p} & $12.62$ && \texttt{abandona1\_p} & $0.020$ && \texttt{abandona1\_p} & $\approx 0$\\
    \texttt{pa1\_prom} & $10.18$ && \texttt{edad} & $0.016$ && \texttt{edad} & $\approx 0$ \\
    \texttt{prom\_edad} & $9.60$ && \texttt{p\_recursa} & $0.007$ && \texttt{p\_recursa} & $\approx 0$ \\
    \texttt{p\_ext} & $8.76$ && \texttt{pa1\_prom} & $0.006$ && \texttt{pa1\_prom} & $\approx 0$ \\
    \texttt{p\_recursa} & $8.50$ && \texttt{turno} & $0.005$ && \texttt{turno} & $\approx 0$ \\
    \texttt{n\_alum} & $7.60$ && \texttt{facultad} & $0.004$ && \texttt{facultad} & $\approx 0$ \\
    \texttt{facultad} & $3.20$ && \texttt{prom\_edad} & $0.004$ && \texttt{prom\_edad} & $\approx 0$\\
    \texttt{turno} & $2.91$ && \texttt{extranjero} & $0.003$ && \texttt{extranjero} & $\approx 0$\\
    \texttt{edad} & $2.89$ && \texttt{SEDE} & $0.002$ && \texttt{SEDE} & $\approx 0$ \\
    \texttt{SEDE} & $2.77$ && \texttt{MATERIA} & $0.002$ && \texttt{MATERIA} & $\approx 0$\\
    \texttt{recurso} & $2.38$ && \texttt{p\_ext} & $0.002$ && \texttt{p\_ext} & $\approx 0$ \\
    \texttt{extranjero} & $1.47$ && \texttt{cuat} & $0.001$ && \texttt{cuat} & $\approx 0$\\
    \texttt{cuat} & $1.10$ && \texttt{n\_alum} & $0.001$ && \texttt{n\_alum} & $\approx 0$\\
    \texttt{MATERIA} & $1.00$ && \texttt{recurso} & $0.000$ && \texttt{recurso} & $\approx 0$\\
    \hline
    \end{tabular}
    \label{tab:impbase}
    \end{center}
\end{table}

El experimento de entrenamientos múltiples utilizando distintas observaciones para los conjuntos de entrenamiento y de evaluación entrega resultados estables en las importancias, como se puede ver en el orden de las 5 más importantes variables en cada repetición en la tabla \ref{tab:repeticiones}, y también en los valores de AP, con un valor medio de $0.588$ y una desviación estándar igual a $0.005$.\par\medskip

\begin{table}[!ht]
    % \small
    \caption{Orden de importancias de las 5 variables más importantes en entrenamientos con diferentes observaciones en los conjuntos de entrenamiento y de evaluación.}
    \begin{center}
    \begin{tabular}{rcccccccccc}
    \hline
    \textbf{variable} & \textbf{1} & \textbf{2} & \textbf{3} & \textbf{4} & \textbf{5}& \textbf{6}& \textbf{7}& \textbf{8}& \textbf{9}& \textbf{10}\\
    \hline
    \texttt{abandona1\_p} & 2 & 2 & 2 & 2 & 2 & 2 & 2 & 2 & 2 & 2\\
    \texttt{edad} & & & & & 5 & &  & & & \\
    \texttt{p\_ext} & & & & & & &  & & 5 & \\
    \texttt{p\_recursa} & 5 & 5 & 5 & 3 & 3 & 5 & 5 & 5 &  & 4 \\
    \texttt{pa1} & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 \\
    \texttt{pa1\_prom} & 3 & 4 & 4 & 4 & & 4 & 4 & 4 & 3 & 3 \\
    \texttt{prom\_edad} & 4 & 3 & 3 & 5 & & 3 & 3 & 3 & 4 & 5 \\
    \texttt{turno} & & & & & 4 & &  & & & \\
    \hline
    \end{tabular}
    \label{tab:repeticiones}
    \end{center}
\end{table}

Recordando que en el análisis exploratorio se observó que una proporción muy grande de los casos positivos (abandona después del primer parcial) se corresponden a notas bajas en el primer parcial, se decidió entrenar el clasificador utilizando solo las observaciones con calificaciones en el primer parcial mayores a 3 ($\text{pa1} > 3$). En este caso, la proporción de casos positivos respecto del total es igual $4.2\%$, un desequilibrio muy pronunciado. El AP de este modelo resultó igual a $0.126$, es decir que sigue siendo significativamente mayor a un clasificador al azar. Pero con estas condiciones la contribución de la nota del parcial 1 ya no es tan importante, como se puede observar en la taba \ref{tab:impbase2}. \par\medskip 


\begin{table}[!ht]
    % \small
    \caption{Importancias de las 5 variables más importantes informadas por XGBoost en el clasificador entrenado con la condición $\text{pa1} > 3$.}
    \begin{center}
    \begin{tabular}{cc}
    \hline
    \textbf{variable} & \textbf{importancia}\\
    \hline
    \texttt{pa1}  & $8.73$\\
    \texttt{abandona1\_p} & $7.56$\\
    \texttt{pa1\_prom} & $6.46$ \\
    \texttt{prom\_edad} & $6.21$\\
    \texttt{p\_recursa} & $5.52$\\
    \hline
    \end{tabular}
    \label{tab:impbase2}
    \end{center}
\end{table}


\section{Conclusión}

Se demostró que el método propuesto es adecuado para estudiar si ciertas variables exógenas influyen en los niveles de deserción, mediante la evaluación de clasificadores. Con el conjunto de datos utilizado en este trabajo, de calidad regular y limitado en variables, se logró determinar que las variables más importantes en la clasificación de abandonos con XGBoost son todas variables que expresan características de los cursos, exceptuando a la nota del primer parcial obtenida por el estudiante, cuando se la incluye.\par\medskip 

\printbibliography
\addcontentsline{toc}{section}{\protect\numberline{}Referencias}%

\appendix

\section{Repositorio de código y datos}

El código utilizado en este trabajo se puede descargar del repositorio en GitHub:\par\medskip

\url{https://github.com/epplugins/TT1} \par\medskip 

En dicho repositorio también se encuentran los datos, pero solo en su versión procesada y anonimizada, debido a que es un repositorio público. Debido a esto, las partes del código que se encargan del procesamiento y limpieza de los datos originales no pueden ser ejecutadas.\par\medskip 

\end{document}
